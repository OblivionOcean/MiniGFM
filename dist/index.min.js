class MiniGFM{patterns={codeBlock:/(?:^|\n)```([\s\S]*?)\n([\s\S]*?)\n```/g,inlineCode:/`([^`]+)`/g,bold:/\*\*(.+?)\*\*/g,italic:/(?<!\*)_(.+?)_(?!\*)|(?<!\*)\*(.+?)\*(?!\*)/g,strike:/~~(.+?)~~/g,heading:/^[^\\]\s*(#{1,6}) (.+)$/gm,unorderedList:/^([ ]{0,3})[-*+] ([^-\_\*]+)$/gm,orderedList:/^([ ]{0,3})\d+\. ([^-\_\*])$/gm,taskList:/^([ ]{0,3})[-*+] \[([ xX]?)\]\s([^-\_\*]+)$/gm,blockquote:/^> (.+)$/gm,table:/^([^\n]*\|[^\n]*)\n([-:| ]+\|)+[-\| ]*\n((?:[^\n]*\|[^\n]*(?:\n|$))*)/gm,link:/\[([^\]]+)\]\(([^\)]+)\)/g,image:/!\[([^\]]+)\]\(([^\)]+)\)/g,autoLink:/<((?:https?:\/\/|ftp:\/\/|mailto:|tel:)[^>\s]+)>/g,autoEmail:/<([^\s@]+@[^\s@]+\.[^\s@]+)>/g,hr:/^ {0,3}(([*_-])( *\2 *){2,})(?:\s*$|$)/gm,escape:/\\([\\`*_{}[\]()#+\-.!])/g,paragraphSplit:/\\\n|\n{2,}/g};escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"};constructor(e){this.options=e||{}}parse(e){e=this.escape(e),this.options.unsafe&&(e=this.escapeHTML(e));let a=[];return e=e.replace(this.patterns.codeBlock,(e,t,s)=>(a.push({lang:t,code:s.trim()}),`<!----CODEBLOCK${a.length-1}---->`)),e=this.parseBlocks(e),e=(e=this.parseInlines(e)).replace(/<!----CODEBLOCK(\d+)---->/g,(e,t)=>a[parseInt(t)]?(t=a[parseInt(t)]).lang?(this.options.hljs&&(t.code=this.options.hljs.highlight(t.code,{language:t.lang}).value),`<pre><code class="hljs ${t.lang} lang-${t.lang}">${t.code}</code></pre>`):(this.options.hljs&&(t.code=this.options.hljs.highlightAuto(t.code).value),`<pre><code>${t.code}</code></pre>`):"")}escape(e){return e.replace(this.patterns.escape,"$1")}parseBlocks(e){return(e=(e=(e=(e=(e=(e=(e=e.replace(this.patterns.heading,(e,t,s)=>`<h${t.length}>${s}</h${t.length}>`)).replace(this.patterns.taskList,(e,t,s,a)=>t+`<li><input type="checkbox" ${"x"===s.trim().toLowerCase()?"checked":""} disabled> ${a}</li>`)).replace(this.patterns.unorderedList,(e,t,s)=>t+`<li>${s}</li>`)).replace(this.patterns.orderedList,(e,t,s)=>t+`<li>${s}</li>`)).replace(this.patterns.hr,()=>"<hr>")).replace(this.patterns.blockquote,(e,t)=>`<blockquote>${t}</blockquote>`)).replace(this.patterns.table,(e,t,s,a)=>this.parseTable(t,s,a))).split(this.patterns.paragraphSplit).map(e=>e.startsWith("<")||e.match(/^<[a-z]+/i)?e:`<p>${e}</p>`).join("<br />")}parseTable(e,t,s){var a=e.split("|").map(e=>e.trim()).filter(e=>e);let r=this.parseTableAlignment(t);var i,l=[];for(i of s.trim().split("\n"))if(i.match(this.patterns.tableRow)){var p=i.split("|").map(e=>e.trim()),n=[];for(let e=0;e<a.length;e++)n.push(p[e]||"");l.push(n)}let h="<table>";return h+="<thead><tr>",a.forEach((e,t)=>{t=r[t]?` align="${r[t]}"`:"";h+=`<th${t}>${this.escapeHTML(e)}</th>`}),h+="</tr></thead>",0<l.length&&(h+="<tbody>",l.forEach(e=>{h+="<tr>",e.forEach((e,t)=>{t=r[t]?` align="${r[t]}"`:"";h+=`<td${t}>${this.escapeHTML(e)}</td>`}),h+="</tr>"}),h+="</tbody>"),h+="</table>"}parseTableAlignment(e){var t,s=[];for(t of e.split("|").map(e=>e.trim()))t&&(t.startsWith(":")&&t.endsWith(":")?s.push("center"):t.startsWith(":")?s.push("left"):t.endsWith(":")?s.push("right"):s.push(null));return s}parseInlines(e){return e=(e=(e=(e=(e=(e=(e=(e=e.replace(this.patterns.inlineCode,"<code>$1</code>")).replace(this.patterns.bold,"<strong>$1</strong>")).replace(this.patterns.italic,(e,t,s)=>`<em>${t||s}</em>`)).replace(this.patterns.strike,"<del>$1</del>")).replace(this.patterns.autoLink,'<a href="$1">$1</a>')).replace(this.patterns.autoEmail,'<a href="mailto:$1">$1</a>')).replace(this.patterns.link,'<a href="$2">$1</a>')).replace(this.patterns.image,'<img src="$2" alt="$1"></img>')}escapeHTML(e){return e.replace(/[&<>"']/g,e=>this.escapeMap[e])}}module.exports={MiniGFM:MiniGFM};